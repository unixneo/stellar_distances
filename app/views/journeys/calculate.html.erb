<%= turbo_frame_tag "results" do %>
  <!-- Main Result Card -->
  <div class="card result">
    <div class="card-title">üìç Journey to <%= @result[:star].name %></div>
    <p style="color: var(--text-muted); margin-top: -0.5rem; margin-bottom: 1rem;">
      Using <%= @result[:propulsion_system].name %>
    </p>
    
    <% if @result[:is_solar_system] && @result[:realistic_travel_days].present? %>
      <!-- SOLAR SYSTEM: Show realistic time prominently -->
      <div class="result-hero">
        <span class="result-value"><%= @result[:realistic_travel_human] %></span>
        <span class="result-unit">realistic mission duration</span>
      </div>
      
      <div class="disclaimer-box" style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
        <strong style="color: #92400e;">üõ∞Ô∏è Why doesn't the rocket choice matter?</strong>
        <p style="color: #92400e; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
          Within our solar system, <strong>orbital mechanics‚Äînot engine power‚Äîdetermines travel time.</strong>
          All chemical rockets (including Starship) use similar minimum-energy transfer orbits.
          A faster trajectory requires exponentially more fuel, which current technology can't carry.
        </p>
        <p style="color: #92400e; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
          <em>Mission reference: <%= @result[:realistic_travel_notes] %></em>
        </p>
      </div>
      
      <div class="comparison-box" style="background: #f1f5f9; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
        <strong>Straight-line calculation (for comparison): <%= @result[:travel_time_human] %></strong>
        <p style="color: var(--text-muted); margin: 0.5rem 0 0 0; font-size: 0.85rem;">
          This simplified calculation assumes constant velocity in a straight line, ignoring orbital mechanics.
          Real spacecraft follow curved trajectories and use gravity assists.
        </p>
      </div>
    <% else %>
      <!-- INTERSTELLAR or no realistic data: Show calculated time -->
      <div class="result-hero">
        <span class="result-value"><%= @result[:travel_time_human] %></span>
        <span class="result-unit">one-way travel time</span>
      </div>
      
      <% if @result[:is_solar_system] %>
        <!-- Solar system object without realistic data (Oort Cloud) -->
        <div class="disclaimer-box" style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
          <strong style="color: #92400e;">‚ö†Ô∏è Estimated only:</strong>
          <p style="color: #92400e; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
            <% if @result[:star].realistic_travel_notes.present? %>
              <%= @result[:star].realistic_travel_notes %>
            <% else %>
              No spacecraft has traveled to this destination. Time shown is a straight-line estimate.
            <% end %>
          </p>
        </div>
      <% end %>
    <% end %>
    
    <div class="result-grid">
      <div class="result-item">
        <div class="result-item-label">Distance</div>
        <div class="result-item-value">
          <% if @result[:is_solar_system] %>
            <%= @result[:star].formatted_distance %>
          <% else %>
            <%= number_with_delimiter(@result[:distance_ly].round(2)) %> ly
          <% end %>
        </div>
      </div>
      
      <div class="result-item">
        <div class="result-item-label">Velocity</div>
        <div class="result-item-value">
          <% if @result[:velocity_fraction_c] >= 0.01 %>
            <%= (@result[:velocity_fraction_c] * 100).round(2) %>% c
          <% else %>
            <%= number_with_delimiter(@result[:velocity_km_s].round(1)) %> km/s
          <% end %>
        </div>
      </div>
      
      <div class="result-item">
        <div class="result-item-label">Generations</div>
        <div class="result-item-value"><%= number_with_delimiter(@result[:generations]) %></div>
      </div>
    </div>
  </div>

  <!-- Scientific Methodology -->
  <div class="card">
    <div class="card-title">üìê Calculation Method</div>
    <p><%= @result[:calculation_disclaimer] %></p>
  </div>

  <!-- Communication Delay -->
  <div class="card">
    <div class="card-title">üì° Communication Reality</div>
    <div class="comm-grid">
      <div>
        <strong>Message travel time (one way):</strong><br>
        <span style="font-size: 1.25rem; color: var(--primary);">
          <% delay_seconds = @result[:communication_delay_years] * 31_557_600 %>
          <% if delay_seconds < 60 %>
            <%= delay_seconds.round(1) %> seconds
          <% elsif delay_seconds < 3600 %>
            <%= (delay_seconds / 60.0).round(1) %> minutes
          <% elsif delay_seconds < 86400 %>
            <%= (delay_seconds / 3600.0).round(1) %> hours
          <% elsif @result[:communication_delay_years] < 1 %>
            <%= (@result[:communication_delay_years] * 365.25).round(1) %> days
          <% else %>
            <%= number_with_delimiter(@result[:communication_delay_years].round(1)) %> years
          <% end %>
        </span>
      </div>
      <div>
        <strong>Round-trip communication:</strong><br>
        <span style="font-size: 1.25rem; color: var(--primary);">
          <% rt_seconds = @result[:round_trip_communication_years] * 31_557_600 %>
          <% if rt_seconds < 60 %>
            <%= rt_seconds.round(1) %> seconds
          <% elsif rt_seconds < 3600 %>
            <%= (rt_seconds / 60.0).round(1) %> minutes
          <% elsif rt_seconds < 86400 %>
            <%= (rt_seconds / 3600.0).round(1) %> hours
          <% elsif @result[:round_trip_communication_years] < 1 %>
            <%= (@result[:round_trip_communication_years] * 365.25).round(1) %> days
          <% else %>
            <%= number_with_delimiter(@result[:round_trip_communication_years].round(1)) %> years
          <% end %>
        </span>
      </div>
    </div>
    <p class="hint" style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted);">
      Light-speed communication is a hard physical limit. Nothing‚Äîno signal, no information‚Äîcan travel faster.
    </p>
  </div>

  <!-- Energy Requirements -->
  <div class="card">
    <div class="card-title">‚ö° Energy Requirements</div>
    <p style="color: var(--text-muted);">
      To accelerate <%= number_with_delimiter(@result[:payload_mass_kg].round(0)) %> kg to
      <%= @result[:propulsion_system].formatted_velocity %>:
    </p>
    <div class="energy-grid">
      <div class="energy-item">
        <div class="energy-value"><%= number_with_delimiter(@result[:energy_in_hiroshima_bombs].round(1)) %></div>
        <div class="energy-label">Hiroshima bombs equivalent</div>
      </div>
      <div class="energy-item">
        <div class="energy-value">
          <% if @result[:energy_in_world_years] < 0.001 %>
            <%= (@result[:energy_in_world_years] * 365.25).round(2) %> days
          <% elsif @result[:energy_in_world_years] < 1 %>
            <%= (@result[:energy_in_world_years] * 12).round(1) %> months
          <% else %>
            <%= number_with_delimiter(@result[:energy_in_world_years].round(1)) %> years
          <% end %>
        </div>
        <div class="energy-label">of total world energy production</div>
      </div>
    </div>
    <p class="hint">
      Note: This is just kinetic energy for acceleration. Does not include deceleration,
      life support, or propulsion system inefficiencies.
    </p>
  </div>

  <!-- Fuel Requirements (Delta-V) -->
  <% unless @result[:is_solar_system] %>
  <div class="card">
    <div class="card-title">üöÄ Fuel Requirements (Tsiolkovsky Rocket Equation)</div>

    <% if @result[:propellantless] %>
      <div class="disclaimer-box" style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
        <strong style="color: #166534;">No propellant required.</strong>
        <p style="color: #166534; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
          <%= @result[:propellantless_reason] %>
        </p>
        <p style="color: #166534; margin: 0.5rem 0 0 0; font-size: 0.9rem;">
          The Tsiolkovsky rocket equation (Œîv = V‚Çë √ó ln(m‚ÇÄ/mf)) does not apply ‚Äî
          this system is not a rocket.
        </p>
      </div>
    <% else %>
      <p style="color: var(--text-muted);">
        To carry <%= number_with_delimiter(@result[:payload_mass_kg].round(0)) %> kg
        using <%= @result[:propulsion_system].name %> (exhaust velocity <%= @result[:exhaust_velocity_km_s] %> km/s):
      </p>

      <table style="width:100%; border-collapse: collapse; margin: 1rem 0;">
        <thead>
          <tr style="border-bottom: 2px solid var(--border-color);">
            <th style="text-align: left; padding: 0.5rem 0;">Scenario</th>
            <th style="text-align: right; padding: 0.5rem 0;">Mass Ratio</th>
            <th style="text-align: right; padding: 0.5rem 0;">Fuel Mass Needed</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid var(--border-color);">
            <td style="padding: 0.5rem 0;">Accelerate only (one-way coast)</td>
            <td style="text-align: right;"><%= number_with_delimiter(@result[:mass_ratio_one_way].round(1)) %>:1</td>
            <td style="text-align: right;"><%= @result[:fuel_mass_one_way_human] %></td>
          </tr>
          <tr style="border-bottom: 1px solid var(--border-color);">
            <td style="padding: 0.5rem 0;">Accelerate + Decelerate (stop at destination)</td>
            <td style="text-align: right;"><%= number_with_delimiter(@result[:mass_ratio_with_decel].round(1)) %>:1</td>
            <td style="text-align: right;"><%= @result[:fuel_mass_with_decel_human] %></td>
          </tr>
          <tr>
            <td style="padding: 0.5rem 0;">Full Round Trip</td>
            <td style="text-align: right;"><%= number_with_delimiter(@result[:mass_ratio_round_trip].round(1)) %>:1</td>
            <td style="text-align: right;"><%= @result[:fuel_mass_round_trip_human] %></td>
          </tr>
        </tbody>
      </table>

      <p class="hint">
        The mass ratio is how many kg of fuel you need per kg of final payload.
        A ratio of 10:1 means 9 kg of fuel for every 1 kg of payload.
        Deceleration requires the same Œîv as acceleration ‚Äî squaring the ratio.
        Round trip compounds this to the 4th power.
      </p>

      <p style="font-size: 0.9rem; color: var(--text-muted);">
        <strong>Œîv = V‚Çë √ó ln(m‚ÇÄ/mf)</strong> ‚Äî
        Exhaust velocity: <%= @result[:exhaust_velocity_km_s] %> km/s |
        Œîv needed: <%= @result[:velocity_km_s] %> km/s
      </p>

      <p class="hint" style="border-top: 1px solid var(--border-color); padding-top: 0.75rem; margin-top: 0.75rem;">
        <strong>Model simplifications:</strong> This uses four equal Œîv burns at cruise velocity
        (accelerate from Earth, decelerate at destination, accelerate back, decelerate at Earth).
        It excludes: Earth's gravity well on departure (~11.2 km/s escape velocity),
        the destination body's gravity well (5‚Äì15 km/s depending on planet), and
        aerobraking on Earth return (which eliminates burn #4 in practice).
        Actual fuel requirements for landing-and-returning missions would be higher.
      </p>
    <% end %>
  </div>
  <% end %>

  <!-- Feasibility Assessment -->
  <div class="card">
    <div class="card-title">
      üéØ Feasibility: 
      <span class="feasibility-<%= @result[:feasibility_assessment][:level] %>">
        <%= @result[:feasibility_assessment][:level].to_s.titleize %>
      </span>
    </div>
    <p><%= @result[:feasibility_assessment][:description] %></p>
  </div>

  <!-- Reality Checks -->
  <% if @result[:reality_check].any? %>
    <div class="reality-checks">
      <div class="reality-checks-title">‚ö†Ô∏è Reality Checks</div>
      <ul>
        <% @result[:reality_check].each do |check| %>
          <li><%= check %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Star Info -->
  <div class="card">
    <div class="card-title">
      <% if @result[:is_solar_system] %>
        ü™ê About <%= @result[:star].name %>
      <% else %>
        ‚≠ê About <%= @result[:star].name %>
      <% end %>
    </div>
    <div class="info-section">
      <p><strong>Type:</strong> <%= @result[:star].star_type %></p>
      <% unless @result[:is_solar_system] %>
        <p><strong>Constellation:</strong> <%= @result[:star].constellation %></p>
      <% end %>
      <p><strong>Notes:</strong> <%= @result[:star].notes %></p>
    </div>
  </div>

  <!-- Propulsion Info -->
  <div class="card">
    <div class="card-title">üîß About <%= @result[:propulsion_system].name %></div>
    <div class="info-section">
      <p><strong>Technology Status:</strong> <%= @result[:propulsion_system].technology_readiness %></p>
      <p><strong>Description:</strong> <%= @result[:propulsion_system].description %></p>
    </div>
  </div>

  <!-- Back to Top -->
  <div style="text-align: center; margin-top: 1rem;">
    <a href="/stellar/journey#top" class="back-button" data-turbo="false">‚Üë New Calculation</a>
  </div>
<% end %>
