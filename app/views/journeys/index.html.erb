<h1 id="top">üöÄ Stellar Distance Calculator</h1>
<p class="subtitle">Why we will always be alone, even if we're not</p>

<%= form_with url: journeys_calculate_path, method: :get, data: { turbo_frame: "results" } do |f| %>
  <div class="card">
    <div class="card-title">üõ∏ Plan Your Journey</div>
    
    <div class="form-grid">
      <div class="form-group">
        <label for="star_id">Destination</label>
        <select name="star_id" id="star_id">
          <optgroup label="Solar System">
            <% @stars.where(constellation: "Solar System").each do |body| %>
              <option value="<%= body.id %>">
                <%= body.name %>
                (<%= body.distance_km < 1_000_000_000 ? "#{number_with_delimiter((body.distance_km / 1_000_000).round(1))} M km" : "#{number_with_delimiter((body.distance_km / 1_000_000_000).round(1))} B km" %>)
              </option>
            <% end %>
          </optgroup>
          <optgroup label="Nearby Stars (< 15 light years)">
            <% @stars.where("distance_ly < 15 AND constellation != 'Solar System'").each do |star| %>
              <option value="<%= star.id %>"><%= star.name %> (<%= star.distance_ly.round(2) %> ly)</option>
            <% end %>
          </optgroup>
          <optgroup label="Notable Stars (15-100 ly)">
            <% @stars.where("distance_ly >= 15 AND distance_ly < 100 AND constellation != 'Solar System'").each do |star| %>
              <option value="<%= star.id %>"><%= star.name %> (<%= star.distance_ly.round(0) %> ly)</option>
            <% end %>
          </optgroup>
          <optgroup label="Distant Stars (100-1000 ly)">
            <% @stars.where("distance_ly >= 100 AND distance_ly < 1000 AND constellation != 'Solar System'").each do |star| %>
              <option value="<%= star.id %>"><%= star.name %> (<%= star.distance_ly.round(0) %> ly)</option>
            <% end %>
          </optgroup>
          <optgroup label="Very Distant (> 1000 ly)">
            <% @stars.where("distance_ly >= 1000 AND constellation != 'Solar System'").each do |star| %>
              <option value="<%= star.id %>"><%= star.name %> (<%= number_with_delimiter(star.distance_ly.round(0)) %> ly)</option>
            <% end %>
          </optgroup>
        </select>
      </div>

      <div class="form-group">
        <label for="propulsion_system_id">Propulsion System</label>
        <select name="propulsion_system_id" id="propulsion_system_id">
          <optgroup label="Current Technology">
            <% @propulsion_systems.where(technology_readiness: ["Operational", "Demonstrated"]).each do |prop| %>
              <option value="<%= prop.id %>"><%= prop.name %></option>
            <% end %>
          </optgroup>
          <optgroup label="In Development / Near-Future">
            <% @propulsion_systems.where(technology_readiness: ["In Development", "Tested Historically", "Proposed"]).each do |prop| %>
              <option value="<%= prop.id %>"><%= prop.name %></option>
            <% end %>
          </optgroup>
          <optgroup label="Theoretical / Speculative">
            <% @propulsion_systems.where(technology_readiness: ["Theoretical", "Theoretical (Banned)", "Far Future", "Speculative"]).each do |prop| %>
              <option value="<%= prop.id %>"><%= prop.name %></option>
            <% end %>
          </optgroup>
        </select>
      </div>

      <div class="form-group">
        <label for="payload_mass_kg">Payload Mass</label>
        <select name="payload_mass_kg" id="payload_mass_kg">
          <option value="0.001">1 gram (microprobe)</option>
          <option value="1">1 kg (small probe)</option>
          <option value="100">100 kg (Voyager-class)</option>
          <option value="1000" selected>1,000 kg (large probe)</option>
          <option value="10000">10,000 kg (crewed capsule)</option>
          <option value="100000">100,000 kg (small ship)</option>
          <option value="1000000">1,000,000 kg (generation ship)</option>
        </select>
      </div>
    </div>

    <button type="submit">Calculate Journey</button>
  </div>
<% end %>

<%= turbo_frame_tag "results" do %>
  <div class="card">
    <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
      <p style="font-size: 1.1rem;">Select a destination and propulsion system to calculate your journey.</p>
      <p class="hint" style="margin-top: 0.5rem;">Spoiler: The universe is very, very big.</p>
    </div>
  </div>
<% end %>

<div class="data-grid">
  <div class="card">
    <div class="card-title">‚≠ê Stellar Catalog</div>
    <table>
      <thead>
        <tr>
          <th>Star</th>
          <th>Distance</th>
          <th>Type</th>
        </tr>
      </thead>
      <tbody>
        <% @stars.limit(12).each do |star| %>
          <tr>
            <td><strong><%= star.name %></strong></td>
            <td><%= star.formatted_distance %></td>
            <td style="font-size: 0.75rem; color: var(--text-muted);"><%= star.star_type %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="card">
    <div class="card-title">üîß Propulsion Systems</div>
    <table>
      <thead>
        <tr>
          <th>System</th>
          <th>Velocity</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <% @propulsion_systems.each do |prop| %>
          <tr>
            <td><strong><%= prop.name %></strong></td>
            <td><%= prop.formatted_velocity %></td>
            <td>
              <% status_class = case prop.technology_readiness
                 when "Operational", "Demonstrated" then "status-operational"
                 when "In Development", "Tested Historically", "Proposed" then "status-tested"
                 when "Far Future" then "status-far-future"
                 else "status-theoretical"
                 end %>
              <span class="status <%= status_class %>"><%= prop.technology_readiness %></span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="card">
  <div class="card-title">‚ÑπÔ∏è About</div>
  <p>This calculator uses real astronomical distances and physics-based propulsion velocities to illustrate the fundamental challenge of interstellar travel.</p>
  <p class="hint" style="margin-top: 0.5rem;">The universe doesn't care about our ambitions. It's just very, very large.</p>
</div>

<footer>
  <p>Data based on current astronomical measurements and physics constraints.</p>
</footer>
